--- 64 ---

; mov rsi,rbp
add rbp,r14
mov [DYNA_PTR.listTopologyEx.objectStop],rbp
;---------- Hybrid CPU topology support, affinity masks and P/E-Cores ---------; 
; RSI = Buffer start
; RBP = Buffer end (offset of first byte after buffer)
; RBX = Pointer to SYS_PARMS structure
; lea rbx,[SYS_PARMS]

; inc [rbx + SYSPARMS.perfCoreTopology.cores]
; inc [rbx + SYSPARMS.effCoreTopology.cores]
;     [rbx + SYSPARMS.perfCoreTopology.threads]
;     [rbx + SYSPARMS.effCoreTopology.threads]
;     [rbx + SYSPARMS.perfCoreAffinity]
;     [rbx + SYSPARMS.effCoreAffinity]


;---------- Exit points -------------------------------------------------------;

--- 32 ---

; mov esi,ebp
add ebp,edi
mov [DYNA_PTR.listTopologyEx.objectStop],ebp
;---------- Hybrid CPU topology support, affinity masks and P/E-Cores ---------; 
; ESI = Buffer start 
; EBP = Buffer end (offset of first byte after buffer)
; EBX = Pointer to SYS_PARMS structure
; mov ebx,SYS_PARMS

; inc [ebx + SYSPARMS.perfCoreTopology.cores]
; inc [ebx + SYSPARMS.effCoreTopology.cores]
;     [ebx + SYSPARMS.perfCoreTopology.threads]
;     [ebx + SYSPARMS.effCoreTopology.threads]
;     [ebx + SYSPARMS.perfCoreAffinity]
;     [ebx + SYSPARMS.effCoreAffinity]

;---------- Exit points -------------------------------------------------------;


--- 64 ---

cmp [SYS_PARMS.perfCoreTopology.cores],0
je .rejectHybridE
cmp [SYS_PARMS.effCoreTopology.cores],0
je .rejectHybridP
mov [SYS_PARMS.hybridMode],1
jmp .doneHybrid
.rejectHybridP:
xor eax,eax
xchg eax,[SYS_PARMS.perfCoreTopology.cores]
mov [SYS_PARMS.summaryTopology.cores],eax
xor eax,eax
xchg eax,[SYS_PARMS.perfCoreTopology.threads]
mov [SYS_PARMS.summaryTopology.threads],eax
jmp .doneHybrid 
.rejectHybridE:
xor eax,eax
xchg eax,[SYS_PARMS.effCoreTopology.cores]
mov [SYS_PARMS.summaryTopology.cores],eax
xor eax,eax
xchg eax,[SYS_PARMS.effCoreTopology.threads]
mov [SYS_PARMS.summaryTopology.threads],eax
.doneHybrid:


--- 32 ---

cmp [SYS_PARMS.perfCoreTopology.cores],0
je .rejectHybridE
cmp [SYS_PARMS.effCoreTopology.cores],0
je .rejectHybridP
mov [SYS_PARMS.hybridMode],1
jmp .doneHybrid
.rejectHybridP:
xor eax,eax
xchg eax,[SYS_PARMS.perfCoreTopology.cores]
mov [SYS_PARMS.summaryTopology.cores],eax
xor eax,eax
xchg eax,[SYS_PARMS.perfCoreTopology.threads]
mov [SYS_PARMS.summaryTopology.threads],eax
jmp .doneHybrid 
.rejectHybridE:
xor eax,eax
xchg eax,[SYS_PARMS.effCoreTopology.cores]
mov [SYS_PARMS.summaryTopology.cores],eax
xor eax,eax
xchg eax,[SYS_PARMS.effCoreTopology.threads]
mov [SYS_PARMS.summaryTopology.threads],eax
.doneHybrid:

